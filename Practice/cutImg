<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Task1</title>
	<style>
	*{margin:0;padding:0;}
	body{background:linear-gradient(90deg,#82D58E,#2DEF68);font-family:"微软雅黑";}
	#smallImg{margin-top:30px;width:20%;transition:all 0.5s;}
	#smallImg img{width:100%;}
	.preview{position:absolute;background-image: url(pic.jpg);background-position:0 0;background-size:cover;background-repeat: no-repeat; top:30px;right:20%; opacity: .6;overflow: hidden;}
	#bigImg{position: absolute;left:0;top:0;}
	.cutImg{position: absolute;top:30px;background:#00FF39;opacity:.5;}
	#ctrl span{display:inline-block;font-size:1.5rem;color:#6B6868;}

	</style>
</head>
<body>
<div id="wrapper">
<div id="smallImg">
<img src="pic.jpg" alt="pic">
</div>
</div>
</body>
<script>
var wrapper=document.getElementById('wrapper');
var img=document.getElementById('smallImg');
var wholeWidth=document.body.clientWidth;
var cutImgArea,previewArea,ctrlArea,widthCtrl,heightCtrl,leftPos,topPos;
img.onmousedown=function(e){
//左键
if(e.button==0){
e.target.style.opacity=0.5;
//判断长按，成功则开始截图(需要修改)
setTimeout(beginCutImg,1000);
function beginCutImg(){
         e.target.style.opacity=1;
         //扩大截图图片
         img.style.width='30%';
         //定义截图区域与预览区域
         var cutImgStr='<div class="cutImg"></div>';
         var previewStr='<div class="preview" ></div>';
         //定义控制区域
         var ctrlAreaStr='<div id="ctrl"><span>截图控制区域:</span><br /></div>'
         //宽高控制区给出最大值与当前值
         var widthCtrlStr='在此输入宽度:  <input type="number" id="widthCtrl" min="0" max="406" value="205"><br />';
         var heightCtrlStr='在此输入高度:  <input type="number" id="heightCtrl" min="0" max="225" value="116"><br />';
         //偏移位置最大量由元素宽高计算，暂不给定
         var positionLeftCtrlStr='在此输入左偏移量:  <input type="number" id="leftPos" min="0"  value="0"><br />';
         var positionTopCtrlStr='在此输入上偏移量:  <input type="number" id="topPos" min="30"  value="30">';
         //添加至DOM结构
         img.innerHTML+=cutImgStr;
         wrapper.innerHTML+=previewStr;
         wrapper.innerHTML+=ctrlAreaStr;
         ctrlArea=document.getElementById('ctrl');
         ctrlArea.innerHTML=ctrlArea.innerHTML+widthCtrlStr+heightCtrlStr+positionLeftCtrlStr+positionTopCtrlStr;
         previewArea=document.getElementsByClassName('preview')[0];
         cutImgArea=document.getElementsByClassName("cutImg")[0];
         //定义截图与预览区域初始大小,均与原始图片大小成比例关系
         //放大后图片宽高均为初始大小的1.5倍(20%=>30%)
         //截图区域宽高初始为放大后图片区域的0.5倍
         //预览区域宽高为放大后图片区域的1.5倍
         cutImgArea.style.width=(0.5*smallImg.offsetWidth)+'px';
         cutImgArea.style.height=(0.5*smallImg.offsetHeight)+'px'
         previewArea.style.width=(3*cutImgArea.offsetWidth)+'px';
         previewArea.style.height=(3*cutImgArea.offsetHeight)+'px'
         previewArea.style.backgroundSize='200%,200%';   
         //获取控制元素
         widthCtrl=document.getElementById('widthCtrl');
         heightCtrl=document.getElementById('heightCtrl');
         positionLeftCtrl=document.getElementById('leftPos');
         positionTopCtrl=document.getElementById('topPos'); 
         //绑定事件
         widthCtrl.addEventListener('change',widthChange,false);
         heightCtrl.addEventListener('change',heightChange,false);
         positionLeftCtrl.addEventListener('change',leftPosChange,false);
         positionTopCtrl.addEventListener('change',topPosChange,false);
        }
    }
}

//控制区域

function widthChange(){
  var currentWidth=this.value;
  //临界值情况
  if(currentWidth<0){
  	currentWidth=0;
  }else if(currentWidth>(wholeWidth*0.3)){
  	currentWidth=wholeWidth*0.3;
  }
  cutImgArea.style.width=currentWidth+'px';

}
function heightChange(){
  var currentHeight=this.value;
  //临界值情况
  if(currentHeight<0){
  	currentHeight=0;
  }else if(currentHeight>228){
  	currentHeight=228;
  }
   cutImgArea.style.height=currentHeight+'px';
}
function leftPosChange(){
  var currentPos=this.value;
  //获取当前截图区域宽度
  var currentWidth=cutImgArea.offsetWidth;
  //最大左偏移
  var maxLeftPos=wholeWidth*0.3-currentWidth;
  //临界值判断
  if(currentPos>maxLeftPos){
  	currentPos=maxLeftPos;
  }else if(currentPos<0){
  	currentPos=0;
  }
  cutImgArea.style.left=currentPos+'px';
}
function topPosChange(){
  var currentPos=this.value;
  var currentHeight=cutImgArea.offsetHeight;
  //需要根据img元素高度确定剩余可用偏移
  var allHeight=img.offsetHeight;
  alert(allHeight);
 // var maxTopPos=
  cutImgArea.style.top=currentPos+'px';
}
//var cutImg=document.getElementsByClassName('cutImg')[0];
//cutImg.addEventListener('dragstart', dragstart, false);
//cutImg.addEventListener('dragenter', dragenter, false);
//cutImg.addEventListener('dragover', dragover, false);
//cutImg.addEventListener('dragleave', dragleave, false);
//cutImg.addEventListener('drop', drop, false);
//cutImg.addEventListener('dragend', dragend, false);
//function dragstart(){}
//function dragenter(){}
//function dragover(){}
//function dragleave(){}
//function drop(){}
//function dragend(){}
//

//调整background-position与截图区域同步
//截图区域大小比例与预览区域同步
//预览区域比截图区域大一定比例
</script>
</html>
